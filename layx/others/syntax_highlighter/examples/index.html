<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Layx Syntax Highlighter</title>
        <link rel="stylesheet" href="../syntax_highlighter.css">
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
            rel="stylesheet">
        <style>
            :root {
                /* Default (Light) Theme Variables */
                --bg-color: #f8f9fa;
                --surface-color: #ffffff;
                --text-color: #1f2937;
                --border-color: #e5e7eb;
                --primary-color: #3b82f6;
                --secondary-color: #6b7280;
                --radius: 8px;
                --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }

            [theme="dark"] {
                /* Dark Theme Variables */
                --bg-color: #111827;
                --surface-color: #1f2937;
                --text-color: #f9fafb;
                --border-color: #374151;
                --primary-color: #60a5fa;
                --secondary-color: #9ca3af;
                --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            }

            * {
                box-sizing: border-box;
                transition: background-color 0.3s ease, color 0.3s ease;
            }

            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                margin: 0;
                padding: 40px 20px;
                line-height: 1.6;
            }

            .container {
                max-width: 900px;
                margin: 0 auto;
            }

            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 60px;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 20px;
            }

            h1 {
                font-size: 2.5rem;
                font-weight: 800;
                margin: 0;
                background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .subtitle {
                color: var(--secondary-color);
                font-size: 1.1rem;
                margin-top: 5px;
            }

            .theme-toggle {
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                color: var(--text-color);
                padding: 8px 16px;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 500;
                box-shadow: var(--shadow);
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .theme-toggle:hover {
                border-color: var(--primary-color);
            }

            section {
                margin-bottom: 50px;
            }

            h2 {
                font-size: 1.5rem;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .badge {
                font-size: 0.8rem;
                background: var(--primary-color);
                color: white;
                padding: 2px 8px;
                border-radius: 4px;
                font-weight: 600;
                text-transform: uppercase;
            }

            p {
                color: var(--secondary-color);
                margin-bottom: 20px;
            }

            /* Override highlighter font */
            [data-code-lang] {
                font-family: 'JetBrains Mono', monospace !important;
                box-shadow: var(--shadow);
                border: 1px solid var(--border-color);
            }

            button.copy {
                background: transparent;
                border: 1px solid var(--border-color);
                color: var(--secondary-color);
                cursor: pointer;
                border-radius: 4px;
                padding: 4px 8px;
                transition: all 0.2s;
            }

            button.copy:hover {
                background: var(--bg-color);
                color: var(--primary-color);
            }
        </style>
    </head>

    <body>

        <div class="container">
            <header>
                <div>
                    <h1>Layx Highlighter</h1>
                    <div class="subtitle">Lightweight, client-side syntax highlighting.</div>
                </div>
                <button class="theme-toggle" id="themeBtn">
                    <span>üåô</span> Toggle Theme
                </button>
            </header>              

            <section>
                <h2>JavaScript <span class="badge">ES6+</span></h2>
                <p>Highlights classes, template literals, functions, and more.</p>
<pre data-code-lang="js">
/**
 * Syntax Highlighter Stress Test
 * Testing: Regex, Template Literals, Classes, and Async logic.
 */

import DefaultExport, { NamedExport as Alias } from 'node:events';

const SYMBOL_KEY = Symbol('__highlighter_test__');

class TestBench extends Alias {
  #privateField = 42;
  static staticField = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/g;

  constructor(options = {}) {
    super();
    this.config = { 
      timeout: options?.timeout ?? 1000,
      enabled: true 
    };
  }

  async *generateData(items) {
    for (const item of items) {
      // Testing template literal nesting and escapes
      yield `Processing: ${item} (Index: ${items.indexOf(item)}) \`Inner Backtick\``;
      
      try {
        await new Promise(r => setTimeout(r, this.#privateField));
      } catch (err) {
        console.error(err?.message || 'Unknown error');
      }
    }
  }

  calculate(val) {
    // Testing operators and multi-line logic
    return val << 2 >>> 1 !== 10 ? (val ** 2) : Math.sqrt(val);
  }
}

// Testing Regex vs Division ambiguity
const regexTest = / \/ /g.test(" / "); 
const divisionTest = 10 / 2 / 5;

const complexObject = {
  get [SYMBOL_KEY]() {
    return "Dynamic Key Content";
  },
  "quoted-property": true,
  nullValue: null,
  undefinedValue: undefined,
  bigInt: 9007199254740991n
};

/*
  Block comment with 
  // Nested single line comment
  var shouldNotBeHighlightedAsKeyword = true;
*/

(async function main() {
  const bench = new TestBench({ timeout: 500 });
  const data = ["Alpha", "Beta", "Gamma"];

  for await (const status of bench.generateData(data)) {
    console.log(`%c ${status}`, "color: #00ff00; font-weight: bold;");
  }
  
  const result = bench.calculate(divisionTest?.toString().length ?? 0);
  console.log(`Final result: ${result}`);
})();
</pre>
            </section>

            <section>
                <h2>CSS <span class="badge">Modern</span></h2>
                <p>Support for nested rules, variables, and media queries.</p>
<pre data-code-lang="css">
/* TODO Test Modern CSS Features */
@charset "UTF-8";

@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap");
@import "animations.css" layer(animations);

@layer reset, base, components, utilities;

@namespace url(http://www.w3.org/1999/xhtml);
@namespace svg url(http://www.w3.org/2000/svg);

@font-face {
  /* test */
  font-family: "CustomFont";
  src: url("font.woff2") format("woff2"),
       url("font.woff") format("woff");
  font-weight: 100 900;
  font-display: swap;
}

@property --gradient-angle {
  syntax: "<angle>";
  initial-value: 0deg;
  inherits: false;
}

@property --my-color {
  syntax: "<color>";
  initial-value: #c0ffee;
  inherits: true;
}

@counter-style custom-counter {
  system: cyclic;
  symbols: ‚óâ ‚óå ‚óé;
  suffix: " ";
}

:root {
  --primary: oklch(0.7 0.2 200);
  --secondary: color-mix(in oklch, var(--primary) 80%, white);
  --spacing-xs: 0.25rem;
  --spacing-sm: clamp(0.5rem, 2vw, 1rem);
  --grid-gap: max(1rem, 2%);
  --border-radius: round(up, 12px, 4px);
}

@supports (container-type: inline-size) {
  .card {
    container-type: inline-size;
    container-name: card;
  }
}

/* Nesting & Scoping */
.container div {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
  gap: var(--grid-gap);
  
  & > p.test h3 {
    background: light-dark(white, #1a1a1a);
    padding: var(--spacing-sm);
    border: 1px solid color-mix(in srgb, currentColor 20%, transparent);
    
    &:hover {
      scale: 1.05;
      rotate: 2deg;
      translate: 0 -5px;
    }
    
    &:has(> img) {
      aspect-ratio: 16 / 9;
    }
    
    @media (width >= 768px) {
      padding: calc(var(--spacing-sm) * 2);
    }
  }
}

/* Container Queries */
@container card (min-width: 400px) {
  .card-title {
    font-size: clamp(1.5rem, 4cqw, 2.5rem);
  }
}

/* Advanced Selectors */
:is(article, section, aside):has(> h2) {
  margin-block: 2rem;
}

:where(.button, .link):not(:disabled, [aria-disabled="true"]) {
  cursor: pointer;
  
  &:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
}

/* Cascade Layers */
@layer components {
  .button {
    all: unset;
    padding: 0.5em 1em;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-radius: var(--border-radius);
    
    &[data-variant="ghost"] {
      background: none;
      color: var(--primary);
      border: 1px solid currentColor;
    }
  }
}

/* Complex Animations */
@keyframes spin-colors {
  from {
    --gradient-angle: 0deg;
    filter: hue-rotate(0deg);
  }
  to {
    --gradient-angle: 360deg;
    filter: hue-rotate(360deg);
  }
}

@keyframes slide-fade {
  0% {
    opacity: 0;
    translate: -100% 0;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    opacity: 1;
    translate: 0 0;
  }
}

/* Scroll-driven Animations */
@supports (animation-timeline: scroll()) {
  .parallax {
    animation: parallax linear;
    animation-timeline: scroll();
  }
  
  @keyframes parallax {
    to {
      translate: 0 -50%;
    }
  }
}

/* View Transitions */
@view-transition {
  navigation: auto;
}

::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 0.3s;
}

/* Complex Functions & Calculations */
.complex-layout {
  width: calc(100% - var(--spacing-sm) * 2);
  height: max(50vh, 400px);
  padding: clamp(1rem, 5vw, 3rem);
  margin-inline: auto;
  
  background: 
    linear-gradient(
      calc(var(--gradient-angle) + 45deg),
      oklch(0.7 0.2 calc(var(--gradient-angle) * 1)),
      oklch(0.5 0.3 calc(var(--gradient-angle) * 2))
    );
  
  clip-path: polygon(
    0 0,
    100% 0,
    100% calc(100% - 2rem),
    calc(100% - 2rem) 100%,
    0 100%
  );
  
  box-shadow: 
    0 1px 2px hsl(0 0% 0% / 0.1),
    0 4px 8px hsl(0 0% 0% / 0.1),
    0 12px 24px hsl(0 0% 0% / 0.1);
}

/* Subgrid */
.grid-parent {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
  
  & .grid-child {
    display: grid;
    grid-template-columns: subgrid;
    grid-column: span 4;
  }
}

/* Logical Properties */
.card {
  padding-block: 2rem;
  padding-inline: 1.5rem;
  margin-block-end: var(--spacing-sm);
  border-inline-start: 4px solid var(--primary);
  inset-block-start: 0;
  inset-inline-end: 0;
}

/* Media Queries */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@media (prefers-color-scheme: dark) {
  :root {
    --primary: oklch(0.8 0.2 200);
  }
}

@media (orientation: landscape) and (min-width: 1024px) {
  .hero {
    aspect-ratio: 21 / 9;
  }
}

@media (hover: hover) and (pointer: fine) {
  .interactive:hover {
    transform: scale(1.1) rotate(5deg);
  }
}

/* Custom Media Queries (future) */
@custom-media --mobile (width < 768px);
@custom-media --desktop (width >= 1024px);

/* Feature Queries */
@supports (backdrop-filter: blur(10px)) {
  .glass {
    background: rgb(255 255 255 / 0.1);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
  }
}

@supports selector(:has(> img)) {
  .card:has(img) {
    padding: 0;
  }
}

/* Anchor Positioning */
.tooltip {
  position: absolute;
  position-anchor: --trigger;
  bottom: anchor(top);
  left: anchor(center);
  translate: -50% -8px;
}

/* Advanced Pseudo-classes */
input:user-invalid {
  border-color: red;
}

dialog:modal {
  max-width: 90vw;
  max-height: 90vh;
}

:target-within {
  background: color-mix(in srgb, yellow 20%, transparent);
}

/* Color Functions */
.color-demo {
  background: oklch(0.7 0.2 200 / 0.8);
  border-color: lch(50% 50 200);
  color: lab(60% 40 30);
  box-shadow: 0 4px 12px hwb(200 20% 20% / 0.5);
  
  &::before {
    background: color-mix(in oklch, red 30%, blue);
  }
  
  &::after {
    background: color-contrast(
      wheat vs tan, sienna, var(--primary), #d2691e
    );
  }
}

/* Relative Colors */
.relative-colors {
  --base: oklch(0.7 0.2 200);
  background: oklch(from var(--base) calc(l * 0.8) c h);
  border: 1px solid oklch(from var(--base) l calc(c * 1.5) h / 0.5);
}

/* Math Functions */
.math {
  width: round(nearest, 34.6%, 10%);
  height: mod(100vh, 50px);
  padding: rem(18px, 16px);
  gap: hypot(3em, 4em);
  rotate: atan2(1, 1);
}

/* Trigonometry */
.trig {
  transform: rotate(calc(sin(45deg) * 360deg));
  width: calc(cos(60deg) * 100%);
  translate: calc(tan(30deg) * 1rem) 0;
}

/* Advanced Grid */
.masonry {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  grid-template-rows: masonry;
  align-tracks: start;
}

/* Scroll Snap */
.carousel {
  scroll-snap-type: x mandatory;
  scroll-padding-inline: 1rem;
  scrollbar-width: thin;
  scrollbar-color: var(--primary) transparent;
  overscroll-behavior-x: contain;
  
  & > * {
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }
}

/* Text Styling */
.text {
  text-wrap: balance;
  text-box-trim: both;
  text-box-edge: cap alphabetic;
  hanging-punctuation: first last;
  initial-letter: 3 2;
  
  &::first-line {
    font-variant: small-caps;
    letter-spacing: 0.05em;
  }
}

/* Filters & Blend Modes */
.effects {
  filter: 
    blur(4px)
    brightness(1.2)
    contrast(1.1)
    drop-shadow(0 4px 12px rgb(0 0 0 / 0.3))
    grayscale(0.2)
    hue-rotate(45deg)
    invert(0.1)
    saturate(1.5);
  
  mix-blend-mode: multiply;
  background-blend-mode: overlay, soft-light;
}

/* Masks */
.mask {
  mask-image: 
    linear-gradient(to bottom, black 50%, transparent),
    url("mask.svg");
  mask-composite: intersect;
  mask-mode: alpha, luminance;
  mask-size: 100% 100%, contain;
}

/* Multiple Backgrounds */
.multi-bg {
  background: 
    url("pattern.svg") repeat,
    linear-gradient(135deg, var(--primary), transparent),
    radial-gradient(circle at 30% 50%, color-mix(in srgb, red 20%, transparent), transparent 70%),
    conic-gradient(from 90deg at 50% 50%, red, yellow, green, cyan, blue, magenta, red);
  background-size: 50px 50px, cover, cover, cover;
  background-position: 0 0, center, center, center;
  background-blend-mode: overlay, normal, screen, hue;
}
</pre>
            </section>

            <section>
                <h2>HTML <span class="badge">Semantic</span></h2>
                <p>Clean highlighting for tags, strings, and attributes.</p>
                <pre data-code-lang="html"> 
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Dashboard&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="app"&gt;
        &lt;!-- Main Header --&gt;
        &lt;header class="top-bar"&gt;
            &lt;h1&gt;User Dashboard&lt;/h1&gt;
            &lt;nav&gt;
                &lt;a href="/profile" class="active"&gt;Profile&lt;/a&gt;
                &lt;a href="/settings"&gt;Settings&lt;/a&gt;
            &lt;/nav&gt;
        &lt;/header&gt;
        
        &lt;main&gt;
            &lt;p&gt;Welcome back, User!&lt;/p&gt;
        &lt;/main&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
            </section>

            <section>
                <h2>Python <span class="badge">Clean</span></h2>
                <p>Excellent readability for Python scripts.</p>
<pre data-code-lang="py">
import random

class NumberGuesser:
def __init__(self, limit=100):
self.target = random.randint(1, limit)

self.attempts = 0
def guess(self, number):
self.attempts += 1
if number == self.target:
return f"Correct! Found in {self.attempts} tries."
elif number < self.target: return "Too low!" else: return "Too high!" game=NumberGuesser()
print(game.guess(50))
</pre>
            </section>

            <section>
                <h2>JSON <span class="badge">Data</span></h2>
                <p>Clear distinction between keys and values.</p>
<pre data-code-lang="json">
 {
    "server": {
    "host": "localhost",
    "port": 8080,
    "active": true
    },

    "endpoints": [
    "/api/v1/users",
    "/api/v1/posts"
    ],
    
    "timeout": 5000,
    "metadata": null
}
</pre>
            </section>
        </div>

        <script type="module">
            import SyntaxHighlighter from '../syntax_highlighter.js';

            // Theme Toggling Logic
            const btn = document.getElementById('themeBtn');
            const root = document.documentElement;

            // Check system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                root.setAttribute('theme', 'dark');
            }

            btn.addEventListener('click', () => {
                const current = root.getAttribute('theme');
                const newTheme = current === 'dark' ? 'light' : 'dark';
                root.setAttribute('theme', newTheme);
                btn.querySelector('span').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            });

            console.log('SyntaxHighlighter initialized.');
        </script>
    </body>

</html>